<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Yolo v1 – pilus_project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-fe8f458f31a467b51aeabd2275c1e88a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Yolo v1 – pilus_project">
<meta property="og:description" content="Bacteria detection application written in pytorch">
<meta property="og:image" content="https://galopyz.github.io/pilus_project/53_yolov1_files/figure-html/cell-5-output-2.png">
<meta property="og:site_name" content="pilus_project">
<meta property="og:image:height" content="435">
<meta property="og:image:width" content="558">
<meta name="twitter:title" content="Yolo v1 – pilus_project">
<meta name="twitter:description" content="Bacteria detection application written in pytorch">
<meta name="twitter:image" content="https://galopyz.github.io/pilus_project/53_yolov1_files/figure-html/cell-5-output-2.png">
<meta name="twitter:image-height" content="435">
<meta name="twitter:image-width" content="558">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">pilus_project</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./yolov1.html">Yolo v1</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">pilus_project</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./train.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">train</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./darknet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Darknet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pascal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pascal Darknet Classification</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pascal Darknet Detection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./yolov1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Yolo v1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./yolov1_miniai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Yolo v1 using minai</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./yolov1_miniai_bac.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Yolo v1 on bacteria</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#utils" id="toc-utils" class="nav-link active" data-scroll-target="#utils">Utils</a>
  <ul class="collapse">
  <li><a href="#intersection_over_union" id="toc-intersection_over_union" class="nav-link" data-scroll-target="#intersection_over_union">intersection_over_union</a></li>
  <li><a href="#non_max_suppression" id="toc-non_max_suppression" class="nav-link" data-scroll-target="#non_max_suppression">non_max_suppression</a></li>
  <li><a href="#mean_average_precision" id="toc-mean_average_precision" class="nav-link" data-scroll-target="#mean_average_precision">mean_average_precision</a></li>
  <li><a href="#plot_image" id="toc-plot_image" class="nav-link" data-scroll-target="#plot_image">plot_image</a></li>
  <li><a href="#get_bboxes" id="toc-get_bboxes" class="nav-link" data-scroll-target="#get_bboxes">get_bboxes</a></li>
  <li><a href="#load_checkpoint" id="toc-load_checkpoint" class="nav-link" data-scroll-target="#load_checkpoint">load_checkpoint</a></li>
  <li><a href="#save_checkpoint" id="toc-save_checkpoint" class="nav-link" data-scroll-target="#save_checkpoint">save_checkpoint</a></li>
  <li><a href="#cellboxes_to_boxes" id="toc-cellboxes_to_boxes" class="nav-link" data-scroll-target="#cellboxes_to_boxes">cellboxes_to_boxes</a></li>
  <li><a href="#convert_cellboxes" id="toc-convert_cellboxes" class="nav-link" data-scroll-target="#convert_cellboxes">convert_cellboxes</a></li>
  </ul></li>
  <li><a href="#data-loader" id="toc-data-loader" class="nav-link" data-scroll-target="#data-loader">Data Loader</a>
  <ul class="collapse">
  <li><a href="#vocdataset" id="toc-vocdataset" class="nav-link" data-scroll-target="#vocdataset">VOCDataset</a></li>
  </ul></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture">Architecture</a>
  <ul class="collapse">
  <li><a href="#cnnblock" id="toc-cnnblock" class="nav-link" data-scroll-target="#cnnblock">CNNBlock</a></li>
  <li><a href="#yolov1" id="toc-yolov1" class="nav-link" data-scroll-target="#yolov1">Yolov1</a></li>
  </ul></li>
  <li><a href="#loss-function" id="toc-loss-function" class="nav-link" data-scroll-target="#loss-function">Loss function</a>
  <ul class="collapse">
  <li><a href="#yololoss" id="toc-yololoss" class="nav-link" data-scroll-target="#yololoss">YoloLoss</a></li>
  </ul></li>
  <li><a href="#train" id="toc-train" class="nav-link" data-scroll-target="#train">Train</a>
  <ul class="collapse">
  <li><a href="#compose" id="toc-compose" class="nav-link" data-scroll-target="#compose">Compose</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/galopyz/pilus_project/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="yolov1.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Yolo v1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>Yolo v1 provides many fundamental and important concepts for oriented bounding boxes. It is worth learning. Code adapted from https://github.com/aladdinpersson/Machine-Learning-Collection.</p>
<div id="a1fd79bd" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms <span class="im">as</span> transforms</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torchvision.transforms.functional <span class="im">as</span> FT</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> torch.utils.data <span class="im">import</span> DataLoader</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="95b7e988" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_path <span class="op">=</span> fc.Path(<span class="st">'../data'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Path('../data')</code></pre>
</div>
</div>
<section id="utils" class="level2">
<h2 class="anchored" data-anchor-id="utils">Utils</h2>
<p>Some helpful utilities that can help us.</p>
<p>This <a href="https://galopyz.github.io/pilus_project/yolov1.html#intersection_over_union"><code>intersection_over_union</code></a> function calculates the IoU metric between predicted bounding boxes and ground truth boxes. It’s essential for:</p>
<ol type="1">
<li>Evaluating object detection accuracy - IoU measures how well your predicted boxes align with the actual object locations</li>
<li>Non-max suppression - removing duplicate detections by comparing their overlap</li>
<li>Training YOLO - the loss function uses IoU to penalize poor box predictions (not in yolo v1)</li>
</ol>
<p>The function handles two box formats: - “midpoint”: (x,y,w,h) where x,y is the center point - “corners”: (x1,y1,x2,y2) representing top-left and bottom-right corners</p>
<p>It converts boxes to corner format, calculates intersection area (overlap), calculates union area (total area), then returns intersection/union. The 1e-6 term prevents division by zero.</p>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L26" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="intersection_over_union" class="level3">
<h3 class="anchored" data-anchor-id="intersection_over_union">intersection_over_union</h3>
<blockquote class="blockquote">
<pre><code> intersection_over_union (boxes_preds, boxes_labels,
                          box_format='midpoint')</code></pre>
</blockquote>
<p>*Calculates intersection over union</p>
<p>Parameters: boxes_preds (tensor): Predictions of Bounding Boxes (BATCH_SIZE, 4) boxes_labels (tensor): Correct labels of Bounding Boxes (BATCH_SIZE, 4) box_format (str): midpoint/corners, if boxes (x,y,w,h) or (x1,y1,x2,y2)</p>
<p>Returns: tensor: Intersection over union for all examples*</p>
<p>Here is an example:</p>
<div id="a1737f49" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example boxes</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Format: [x, y, width, height] in midpoint format</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>box1 <span class="op">=</span> torch.tensor([<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>])  <span class="co"># Center at (0.5, 0.5) with width=0.4, height=0.5</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>box2 <span class="op">=</span> torch.tensor([<span class="fl">0.45</span>, <span class="fl">0.45</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>])  <span class="co"># Center at (0.45, 0.45) with width=0.3, height=0.4</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add batch dimension</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>boxes_pred <span class="op">=</span> box1.unsqueeze(<span class="dv">0</span>)  <span class="co"># Shape: [1, 4]</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>boxes_label <span class="op">=</span> box2.unsqueeze(<span class="dv">0</span>)  <span class="co"># Shape: [1, 4]</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate IoU</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>iou <span class="op">=</span> intersection_over_union(boxes_pred, boxes_label, box_format<span class="op">=</span><span class="st">"midpoint"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"IoU: </span><span class="sc">{</span>iou<span class="sc">.</span>item()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the boxes</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to corner format for plotting</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> midpoint_to_corners(box):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    x, y, w, h <span class="op">=</span> box</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> x <span class="op">-</span> w<span class="op">/</span><span class="dv">2</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> y <span class="op">-</span> h<span class="op">/</span><span class="dv">2</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x1, y1, w, h</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot box1 (prediction)</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>x1, y1, w, h <span class="op">=</span> midpoint_to_corners(box1)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>rect1 <span class="op">=</span> patches.Rectangle((x1, y1), w, h, linewidth<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'r'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, label<span class="op">=</span><span class="st">'Prediction'</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>ax.add_patch(rect1)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot box2 (ground truth)</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>x1, y1, w, h <span class="op">=</span> midpoint_to_corners(box2)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>rect2 <span class="op">=</span> patches.Rectangle((x1, y1), w, h, linewidth<span class="op">=</span><span class="dv">2</span>, edgecolor<span class="op">=</span><span class="st">'g'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, label<span class="op">=</span><span class="st">'Ground Truth'</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>ax.add_patch(rect2)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"IoU: </span><span class="sc">{</span>iou<span class="sc">.</span>item()<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IoU: 0.6000</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-5-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This <a href="https://galopyz.github.io/pilus_project/yolov1.html#non_max_suppression"><code>non_max_suppression</code></a> function solves a critical problem in object detection: eliminating duplicate detections of the same object.</p>
<p>When a model detects objects, it often generates multiple overlapping bounding boxes for the same object. Non-Max Suppression (NMS) cleans this up by:</p>
<ol type="1">
<li>Filtering out boxes with confidence below a threshold</li>
<li>Sorting remaining boxes by confidence (highest first)</li>
<li>Keeping the highest confidence box and removing others that overlap significantly with it (based on IoU)</li>
<li>Repeating until no boxes remain</li>
</ol>
<p>The function takes: - <code>bboxes</code>: List of detection boxes with format [class_pred, prob_score, x1, y1, x2, y2] - <code>iou_threshold</code>: Maximum allowed overlap between distinct objects - <code>threshold</code>: Minimum confidence score for a detection to be considered - <code>box_format</code>: Whether coordinates are in “midpoint” or “corners” format</p>
<p>This is essential for clean, usable object detection results - without NMS, a single object might appear to be detected multiple times, cluttering your output and making it difficult to count or track objects accurately.</p>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L73" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="non_max_suppression" class="level3">
<h3 class="anchored" data-anchor-id="non_max_suppression">non_max_suppression</h3>
<blockquote class="blockquote">
<pre><code> non_max_suppression (bboxes, iou_threshold, threshold,
                      box_format='corners')</code></pre>
</blockquote>
<p>*Does Non Max Suppression given bboxes</p>
<p>Parameters: bboxes (list): list of lists containing all bboxes with each bboxes specified as [class_pred, prob_score, x1, y1, x2, y2] iou_threshold (float): threshold where predicted bboxes is correct threshold (float): threshold to remove predicted bboxes (independent of IoU) box_format (str): “midpoint” or “corners” used to specify bboxes</p>
<p>Returns: list: bboxes after performing NMS given a specific IoU threshold*</p>
<p>Here is an example:</p>
<div id="f3dc1ca4" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bboxes <span class="op">=</span> [</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.9</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># High confidence box</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.65</span>, <span class="fl">0.65</span>],  <span class="co"># Overlapping box, same class</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>],  <span class="co"># Different location, same class</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="fl">0.95</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># Same location, different class</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># Low confidence, will be filtered</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>threshold<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>bboxes <span class="op">=</span> [box <span class="cf">for</span> box <span class="kw">in</span> bboxes <span class="cf">if</span> box[<span class="dv">1</span>] <span class="op">&gt;</span> threshold]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>bboxes <span class="op">=</span> <span class="bu">sorted</span>(bboxes, key<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>bboxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[1, 0.95, 0.2, 0.2, 0.6, 0.6],
 [0, 0.9, 0.2, 0.2, 0.6, 0.6],
 [0, 0.8, 0.25, 0.25, 0.65, 0.65],
 [0, 0.7, 0.5, 0.5, 0.9, 0.9]]</code></pre>
</div>
</div>
<div id="d913ada6" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>box1 <span class="op">=</span> torch.tensor([<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>box2 <span class="op">=</span> torch.tensor([<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>intersection_over_union(box1, box2, box_format<span class="op">=</span><span class="st">"corners"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([1.0000])</code></pre>
</div>
</div>
<div id="8345684f" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>box_format<span class="op">=</span><span class="st">'corners'</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>iou_threshold<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>chosen_box <span class="op">=</span> bboxes[<span class="dv">0</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> box <span class="kw">in</span> bboxes:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> box[<span class="dv">0</span>] <span class="op">!=</span> chosen_box[<span class="dv">0</span>] <span class="kw">or</span> intersection_over_union(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        torch.tensor(chosen_box[<span class="dv">2</span>:]),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        torch.tensor(box[<span class="dv">2</span>:]),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        box_format<span class="op">=</span>box_format,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">&lt;</span> iou_threshold:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'if true:</span><span class="sc">{</span>box<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'else:</span><span class="sc">{</span>box<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>else:[1, 0.95, 0.2, 0.2, 0.6, 0.6]
if true:[0, 0.9, 0.2, 0.2, 0.6, 0.6]
if true:[0, 0.8, 0.25, 0.25, 0.65, 0.65]
if true:[0, 0.7, 0.5, 0.5, 0.9, 0.9]</code></pre>
</div>
</div>
<div id="0258c239" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example bounding boxes</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Format: [class_pred, prob_score, x1, y1, x2, y2] in corners format</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>bboxes <span class="op">=</span> [</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.9</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># High confidence box</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.65</span>, <span class="fl">0.65</span>],  <span class="co"># Overlapping box, same class</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.9</span>],  <span class="co"># Different location, same class</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="fl">0.95</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># Same location, different class</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.6</span>],  <span class="co"># Low confidence, will be filtered</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply NMS</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>iou_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>confidence_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>nms_boxes <span class="op">=</span> non_max_suppression(bboxes, iou_threshold, confidence_threshold, box_format<span class="op">=</span><span class="st">"corners"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Before NMS:"</span>, <span class="bu">len</span>(bboxes), <span class="st">"boxes"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"After NMS:"</span>, <span class="bu">len</span>(nms_boxes), <span class="st">"boxes"</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, box <span class="kw">in</span> <span class="bu">enumerate</span>(nms_boxes):</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Box </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: class=</span><span class="sc">{</span><span class="bu">int</span>(box[<span class="dv">0</span>])<span class="sc">}</span><span class="ss">, confidence=</span><span class="sc">{</span>box[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">, coords=</span><span class="sc">{</span>box[<span class="dv">2</span>:]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the boxes</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot original boxes</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'r'</span>, <span class="st">'g'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'m'</span>]</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, box <span class="kw">in</span> <span class="bu">enumerate</span>(bboxes):</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> box[<span class="dv">1</span>] <span class="op">&gt;</span> confidence_threshold:</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        rect <span class="op">=</span> patches.Rectangle(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>            (box[<span class="dv">2</span>], box[<span class="dv">3</span>]), </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            box[<span class="dv">4</span>]<span class="op">-</span>box[<span class="dv">2</span>], </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            box[<span class="dv">5</span>]<span class="op">-</span>box[<span class="dv">3</span>], </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            edgecolor<span class="op">=</span>colors[i <span class="op">%</span> <span class="bu">len</span>(colors)], </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            facecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>            linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f"Original </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: class=</span><span class="sc">{</span><span class="bu">int</span>(box[<span class="dv">0</span>])<span class="sc">}</span><span class="ss">, conf=</span><span class="sc">{</span>box[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        ax.add_patch(rect)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot NMS boxes with solid lines</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, box <span class="kw">in</span> <span class="bu">enumerate</span>(nms_boxes):</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    rect <span class="op">=</span> patches.Rectangle(</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        (box[<span class="dv">2</span>], box[<span class="dv">3</span>]), </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        box[<span class="dv">4</span>]<span class="op">-</span>box[<span class="dv">2</span>], </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        box[<span class="dv">5</span>]<span class="op">-</span>box[<span class="dv">3</span>], </span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span>colors[i <span class="op">%</span> <span class="bu">len</span>(colors)], </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f"NMS </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: class=</span><span class="sc">{</span><span class="bu">int</span>(box[<span class="dv">0</span>])<span class="sc">}</span><span class="ss">, conf=</span><span class="sc">{</span>box[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    ax.add_patch(rect)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>ax.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Non-Max Suppression (IoU threshold=</span><span class="sc">{</span>iou_threshold<span class="sc">}</span><span class="ss">, Confidence threshold=</span><span class="sc">{</span>confidence_threshold<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Before NMS: 5 boxes
After NMS: 3 boxes
Box 1: class=1, confidence=0.95, coords=[0.2, 0.2, 0.6, 0.6]
Box 2: class=0, confidence=0.90, coords=[0.2, 0.2, 0.6, 0.6]
Box 3: class=0, confidence=0.70, coords=[0.5, 0.5, 0.9, 0.9]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The <a href="https://galopyz.github.io/pilus_project/yolov1.html#mean_average_precision"><code>mean_average_precision</code></a> function calculates the mAP (Mean Average Precision) metric, which is the standard evaluation metric for object detection models.</p>
<p>Here’s what it does: 1. For each class, it separates predictions and ground truths 2. It sorts predictions by confidence (highest first) 3. For each prediction, it: - Finds the best matching ground truth box - Marks it as a True Positive (TP) if IoU &gt; threshold and that ground truth wasn’t matched before - Otherwise marks it as a False Positive (FP) 4. Calculates precision and recall at each detection threshold 5. Computes the area under the precision-recall curve (AP) for each class 6. Returns the mean of these APs across all classes</p>
<p>Why we need it: - It provides a single-number evaluation of detection performance across all classes - It accounts for both localization accuracy (via IoU) and classification accuracy - It handles the trade-off between precision and recall - It penalizes models for: - Missing objects (lower recall) - False detections (lower precision) - Poor localization (lower IoU) - Confidence miscalibration (via precision-recall curve)</p>
<p>This metric is essential for comparing different object detection models and is used in benchmarks like COCO and PASCAL VOC.</p>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L114" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mean_average_precision" class="level3">
<h3 class="anchored" data-anchor-id="mean_average_precision">mean_average_precision</h3>
<blockquote class="blockquote">
<pre><code> mean_average_precision (pred_boxes, true_boxes, iou_threshold=0.5,
                         box_format='midpoint', num_classes=20)</code></pre>
</blockquote>
<p>*Calculates mean average precision</p>
<p>Parameters: pred_boxes (list): list of lists containing all bboxes with each bboxes specified as [train_idx, class_prediction, prob_score, x1, y1, x2, y2] true_boxes (list): Similar as pred_boxes except all the correct ones iou_threshold (float): threshold where predicted bboxes is correct box_format (str): “midpoint” or “corners” used to specify bboxes num_classes (int): number of classes</p>
<p>Returns: float: mAP value across all classes given a specific IoU threshold*</p>
<div id="51531208" class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample predictions and ground truths</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Format: [image_idx, class_id, confidence, x1, y1, x2, y2]</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>pred_boxes <span class="op">=</span> [</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.9</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>],  <span class="co"># Image 0, class 1, high confidence</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>],  <span class="co"># Image 0, class 0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.7</span>, <span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.9</span>, <span class="fl">0.7</span>],  <span class="co"># Image 1, class 1</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.85</span>, <span class="fl">0.3</span>, <span class="fl">0.25</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>], <span class="co"># Image 1, class 0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">0.6</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>],   <span class="co"># Image 2, class 0</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>true_boxes <span class="op">=</span> [</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">1.0</span>, <span class="fl">0.25</span>, <span class="fl">0.35</span>, <span class="fl">0.65</span>, <span class="fl">0.75</span>],  <span class="co"># Image 0, class 1</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>],      <span class="co"># Image 0, class 0</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">1.0</span>, <span class="fl">0.5</span>, <span class="fl">0.45</span>, <span class="fl">0.85</span>, <span class="fl">0.75</span>],   <span class="co"># Image 1, class 1</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">1.0</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">0.5</span>],      <span class="co"># Image 1, class 0</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>, <span class="dv">0</span>, <span class="fl">1.0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.55</span>, <span class="fl">0.55</span>],    <span class="co"># Image 2, class 0</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mAP</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>mAP <span class="op">=</span> mean_average_precision(</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    pred_boxes<span class="op">=</span>pred_boxes,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    true_boxes<span class="op">=</span>true_boxes,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    iou_threshold<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    box_format<span class="op">=</span><span class="st">"corners"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    num_classes<span class="op">=</span><span class="dv">2</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean Average Precision: </span><span class="sc">{</span>mAP<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Average Precision: 1.0000</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/core.py#L141" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="plot_image" class="level3">
<h3 class="anchored" data-anchor-id="plot_image">plot_image</h3>
<blockquote class="blockquote">
<pre><code> plot_image (image, boxes)</code></pre>
</blockquote>
<p><em>Plots predicted bounding boxes on the image</em></p>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L254" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_bboxes" class="level3">
<h3 class="anchored" data-anchor-id="get_bboxes">get_bboxes</h3>
<blockquote class="blockquote">
<pre><code> get_bboxes (loader, model, iou_threshold, threshold, pred_format='cells',
             box_format='midpoint', device='cpu')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L364" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_checkpoint" class="level3">
<h3 class="anchored" data-anchor-id="load_checkpoint">load_checkpoint</h3>
<blockquote class="blockquote">
<pre><code> load_checkpoint (checkpoint, model, optimizer)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L359" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="save_checkpoint" class="level3">
<h3 class="anchored" data-anchor-id="save_checkpoint">save_checkpoint</h3>
<blockquote class="blockquote">
<pre><code> save_checkpoint (state, filename='my_checkpoint.pth.tar')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L345" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cellboxes_to_boxes" class="level3">
<h3 class="anchored" data-anchor-id="cellboxes_to_boxes">cellboxes_to_boxes</h3>
<blockquote class="blockquote">
<pre><code> cellboxes_to_boxes (out, S=7)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L308" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="convert_cellboxes" class="level3">
<h3 class="anchored" data-anchor-id="convert_cellboxes">convert_cellboxes</h3>
<blockquote class="blockquote">
<pre><code> convert_cellboxes (predictions, S=7)</code></pre>
</blockquote>
<p><em>Converts bounding boxes output from Yolo with an image split size of S into entire image ratios rather than relative to cell ratios. Tried to do this vectorized, but this resulted in quite difficult to read code… Use as a black box? Or implement a more intuitive, using 2 for loops iterating range(S) and convert them one by one, resulting in a slower but more readable implementation.</em></p>
</section>
</section>
<section id="data-loader" class="level2">
<h2 class="anchored" data-anchor-id="data-loader">Data Loader</h2>
<div id="82b3189f" class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_csv <span class="op">=</span> pd.read_csv(fc.Path(<span class="st">'../train.csv'</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>train_csv.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">000012.jpg</th>
<th data-quarto-table-cell-role="th">000012.txt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>000017.jpg</td>
<td>000017.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>000023.jpg</td>
<td>000023.txt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>000026.jpg</td>
<td>000026.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>000032.jpg</td>
<td>000032.txt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>000033.jpg</td>
<td>000033.txt</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e313a933" class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>IMG_DIR <span class="op">=</span> <span class="st">"../data/images"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>LABEL_DIR <span class="op">=</span> <span class="st">"../data/labels"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Image.<span class="bu">open</span>(fc.Path(IMG_DIR)<span class="op">/</span><span class="st">'000017.jpg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L370" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="vocdataset" class="level3">
<h3 class="anchored" data-anchor-id="vocdataset">VOCDataset</h3>
<blockquote class="blockquote">
<pre><code> VOCDataset (csv_file, img_dir, label_dir, S=7, B=2, C=20, transform=None)</code></pre>
</blockquote>
<p>*An abstract class representing a :class:<code>Dataset</code>.</p>
<p>All datasets that represent a map from keys to data samples should subclass it. All subclasses should overwrite :meth:<code>__getitem__</code>, supporting fetching a data sample for a given key. Subclasses could also optionally overwrite :meth:<code>__len__</code>, which is expected to return the size of the dataset by many :class:<code>~torch.utils.data.Sampler</code> implementations and the default options of :class:<code>~torch.utils.data.DataLoader</code>. Subclasses could also optionally implement :meth:<code>__getitems__</code>, for speedup batched samples loading. This method accepts list of indices of samples of batch and returns list of samples.</p>
<p>.. note:: :class:<code>~torch.utils.data.DataLoader</code> by default constructs an index sampler that yields integral indices. To make it work with a map-style dataset with non-integral indices/keys, a custom sampler must be provided.*</p>
<div id="98bbdaa0" class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">"../8examples.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">img</th>
<th data-quarto-table-cell-role="th">label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>000007.jpg</td>
<td>000007.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>000009.jpg</td>
<td>000009.txt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>000016.jpg</td>
<td>000016.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>000019.jpg</td>
<td>000019.txt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>000020.jpg</td>
<td>000020.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>000021.jpg</td>
<td>000021.txt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>000122.jpg</td>
<td>000122.txt</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>000129.jpg</td>
<td>000129.txt</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="08731511" class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Compose(<span class="bu">object</span>):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, transforms):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.transforms <span class="op">=</span> transforms</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, img, bboxes):</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> t <span class="kw">in</span> <span class="va">self</span>.transforms:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            img, bboxes <span class="op">=</span> t(img), bboxes</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> img, bboxes</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> Compose([transforms.Resize((<span class="dv">448</span>, <span class="dv">448</span>)), transforms.ToTensor(),])</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> VOCDataset(</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../8examples.csv"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transform,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    img_dir<span class="op">=</span>IMG_DIR,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    label_dir<span class="op">=</span>LABEL_DIR,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>x0, y0 <span class="op">=</span> train_dataset[<span class="dv">0</span>]</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>x0.shape, y0.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([3, 448, 448]), torch.Size([7, 7, 30]))</code></pre>
</div>
</div>
<div id="c19d196b" class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="at">@fc.delegates</span>(plt.Axes.imshow)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_boxes(im, boxes, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>), ax<span class="op">=</span><span class="va">None</span>, legend<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Plot boxes on image with automatic format detection"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> boxes.shape[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">9</span> <span class="kw">or</span> (<span class="bu">len</span>(boxes.shape) <span class="op">&gt;</span> <span class="dv">1</span> <span class="kw">and</span> boxes.shape[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">9</span>): </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> imshow_with_boxes(im, boxes, figsize<span class="op">=</span>figsize, ax<span class="op">=</span>ax, legend<span class="op">=</span>legend, <span class="op">**</span>kwargs)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> plot_image(im, boxes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e79764ea" class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plot_boxes(x0, y0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="architecture" class="level2">
<h2 class="anchored" data-anchor-id="architecture">Architecture</h2>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L480" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="cnnblock" class="level3">
<h3 class="anchored" data-anchor-id="cnnblock">CNNBlock</h3>
<blockquote class="blockquote">
<pre><code> CNNBlock (in_channels, out_channels, **kwargs)</code></pre>
</blockquote>
<p>*Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing them to be nested in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self) -&gt; None:
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will also have their parameters converted when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool*</p>
<div id="931c7505" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>CNNBlock(<span class="dv">1</span>, <span class="dv">32</span>, kernel_size<span class="op">=</span><span class="dv">1</span>, stride<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>CNNBlock(
  (conv): Conv2d(1, 32, kernel_size=(1, 1), stride=(1, 1), bias=False)
  (batchnorm): BatchNorm2d(32, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  (leakyrelu): LeakyReLU(negative_slope=0.1)
)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L491" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="yolov1" class="level3">
<h3 class="anchored" data-anchor-id="yolov1">Yolov1</h3>
<blockquote class="blockquote">
<pre><code> Yolov1 (in_channels=3, **kwargs)</code></pre>
</blockquote>
<p>*Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing them to be nested in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self) -&gt; None:
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will also have their parameters converted when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool*</p>
<div id="337ae26a" class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Yolov1(split_size<span class="op">=</span><span class="dv">7</span>, num_boxes<span class="op">=</span><span class="dv">2</span>, num_classes<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Yolov1(
  (darknet): Sequential(
    (0): CNNBlock(
      (conv): Conv2d(3, 64, kernel_size=(7, 7), stride=(2, 2), padding=(3, 3), bias=False)
      (batchnorm): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (1): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
    (2): CNNBlock(
      (conv): Conv2d(64, 192, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(192, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (3): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
    (4): CNNBlock(
      (conv): Conv2d(192, 128, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (5): CNNBlock(
      (conv): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (6): CNNBlock(
      (conv): Conv2d(256, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (7): CNNBlock(
      (conv): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (8): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
    (9): CNNBlock(
      (conv): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (10): CNNBlock(
      (conv): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (11): CNNBlock(
      (conv): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (12): CNNBlock(
      (conv): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (13): CNNBlock(
      (conv): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (14): CNNBlock(
      (conv): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (15): CNNBlock(
      (conv): Conv2d(512, 256, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (16): CNNBlock(
      (conv): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (17): CNNBlock(
      (conv): Conv2d(512, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (18): CNNBlock(
      (conv): Conv2d(512, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (19): MaxPool2d(kernel_size=(2, 2), stride=(2, 2), padding=0, dilation=1, ceil_mode=False)
    (20): CNNBlock(
      (conv): Conv2d(1024, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (21): CNNBlock(
      (conv): Conv2d(512, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (22): CNNBlock(
      (conv): Conv2d(1024, 512, kernel_size=(1, 1), stride=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (23): CNNBlock(
      (conv): Conv2d(512, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (24): CNNBlock(
      (conv): Conv2d(1024, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (25): CNNBlock(
      (conv): Conv2d(1024, 1024, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (26): CNNBlock(
      (conv): Conv2d(1024, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
    (27): CNNBlock(
      (conv): Conv2d(1024, 1024, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)
      (batchnorm): BatchNorm2d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
      (leakyrelu): LeakyReLU(negative_slope=0.1)
    )
  )
  (fcs): Sequential(
    (0): Flatten(start_dim=1, end_dim=-1)
    (1): Linear(in_features=50176, out_features=496, bias=True)
    (2): Dropout(p=0.0, inplace=False)
    (3): LeakyReLU(negative_slope=0.1)
    (4): Linear(in_features=496, out_features=1470, bias=True)
  )
)</code></pre>
</div>
</div>
</section>
</section>
<section id="loss-function" class="level2">
<h2 class="anchored" data-anchor-id="loss-function">Loss function</h2>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L564" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="yololoss" class="level3">
<h3 class="anchored" data-anchor-id="yololoss">YoloLoss</h3>
<blockquote class="blockquote">
<pre><code> YoloLoss (S=7, B=2, C=20)</code></pre>
</blockquote>
<p><em>Calculate the loss for yolo (v1) model</em></p>
<div id="be66bcc8" class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>S<span class="op">=</span><span class="dv">7</span><span class="op">;</span> B<span class="op">=</span><span class="dv">2</span><span class="op">;</span> C<span class="op">=</span><span class="dv">20</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>lambda_noobj <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>lambda_coord <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> torch.randn(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">30</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> torch.randn(<span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">25</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> predictions.reshape(<span class="op">-</span><span class="dv">1</span>, S, S, C <span class="op">+</span> B <span class="op">*</span> <span class="dv">5</span>)  <span class="co"># (bs, S, S, 30)</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>predictions.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([1, 7, 7, 30])</code></pre>
</div>
</div>
</section>
</section>
<section id="train" class="level2">
<h2 class="anchored" data-anchor-id="train">Train</h2>
<div id="2b09144d" class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">123</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(seed)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>LEARNING_RATE <span class="op">=</span> <span class="fl">2e-5</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>DEVICE <span class="op">=</span> <span class="st">"cuda"</span> <span class="cf">if</span> torch.cuda.is_available() <span class="cf">else</span> <span class="st">"cpu"</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">16</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>WEIGHT_DECAY <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">150</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>NUM_WORKERS <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>PIN_MEMORY <span class="op">=</span> <span class="va">True</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>LOAD_MODEL <span class="op">=</span> <span class="va">True</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>LOAD_MODEL_FILE <span class="op">=</span> <span class="st">"overfit.pth.tar"</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>IMG_DIR <span class="op">=</span> <span class="st">"../data/images"</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>LABEL_DIR <span class="op">=</span> <span class="st">"../data/labels"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6f9f21aa" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>IMG_DIR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'../data/images'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/galopyz/pilus_project/blob/main/pilus_project/yolov1.py#L684" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="compose" class="level3">
<h3 class="anchored" data-anchor-id="compose">Compose</h3>
<blockquote class="blockquote">
<pre><code> Compose (transforms)</code></pre>
</blockquote>
<p><em>Initialize self. See help(type(self)) for accurate signature.</em></p>
<div id="bb33c074" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>transform <span class="op">=</span> Compose([transforms.Resize((<span class="dv">448</span>, <span class="dv">448</span>)), transforms.ToTensor(),])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_fn(train_loader, model, optimizer, loss_fn):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    loop <span class="op">=</span> tqdm(train_loader, leave<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    mean_loss <span class="op">=</span> []</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> batch_idx, (x, y) <span class="kw">in</span> <span class="bu">enumerate</span>(loop):</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> x.to(DEVICE), y.to(DEVICE)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        out <span class="op">=</span> model(x)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> loss_fn(out, y)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        mean_loss.append(loss.item())</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        optimizer.zero_grad()</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        optimizer.step()</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># update progress bar</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        loop.set_postfix(loss<span class="op">=</span>loss.item())</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean loss was </span><span class="sc">{</span><span class="bu">sum</span>(mean_loss)<span class="op">/</span><span class="bu">len</span>(mean_loss)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8dd11ddf" class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>train_dataset <span class="op">=</span> VOCDataset(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../8examples.csv"</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>transform,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    img_dir<span class="op">=</span>IMG_DIR,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    label_dir<span class="op">=</span>LABEL_DIR,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>x0, y0 <span class="op">=</span> train_dataset[<span class="dv">0</span>]</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>x0.shape, y0.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([3, 448, 448]), torch.Size([7, 7, 30]))</code></pre>
</div>
</div>
<div id="dd726b30" class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>cellboxes_to_boxes(y0.unsqueeze(<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
  [6.0,
   1.0,
   0.6390000581741333,
   0.5675675868988037,
   0.718000054359436,
   0.8408408761024475],
  [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
  [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
  [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]]]</code></pre>
</div>
</div>
<div id="f1515e8f" class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>torch.tensor(cellboxes_to_boxes(y0.unsqueeze(<span class="dv">0</span>))).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([1, 49, 6])</code></pre>
</div>
</div>
<div id="8174cdbd" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>plot_image(train_dataset[<span class="dv">0</span>][<span class="dv">0</span>], y0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-39-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b5f4f8d" class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main():</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Yolov1(split_size<span class="op">=</span><span class="dv">7</span>, num_boxes<span class="op">=</span><span class="dv">2</span>, num_classes<span class="op">=</span><span class="dv">20</span>).to(DEVICE)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    optimizer <span class="op">=</span> optim.Adam(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>        model.parameters(), lr<span class="op">=</span>LEARNING_RATE, weight_decay<span class="op">=</span>WEIGHT_DECAY</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    loss_fn <span class="op">=</span> YoloLoss()</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> LOAD_MODEL:</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        load_checkpoint(torch.load(LOAD_MODEL_FILE), model, optimizer)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    train_dataset <span class="op">=</span> VOCDataset(</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../8examples.csv"</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>transform,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>        img_dir<span class="op">=</span>IMG_DIR,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>        label_dir<span class="op">=</span>LABEL_DIR,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    test_dataset <span class="op">=</span> VOCDataset(</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../test.csv"</span>, transform<span class="op">=</span>transform, img_dir<span class="op">=</span>IMG_DIR, label_dir<span class="op">=</span>LABEL_DIR,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    train_loader <span class="op">=</span> DataLoader(</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>        dataset<span class="op">=</span>train_dataset,</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span>BATCH_SIZE,</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>        num_workers<span class="op">=</span>NUM_WORKERS,</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        pin_memory<span class="op">=</span>PIN_MEMORY,</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>        drop_last<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    test_loader <span class="op">=</span> DataLoader(</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>        dataset<span class="op">=</span>test_dataset,</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>        batch_size<span class="op">=</span>BATCH_SIZE,</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>        num_workers<span class="op">=</span>NUM_WORKERS,</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>        pin_memory<span class="op">=</span>PIN_MEMORY,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>        shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>        drop_last<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(EPOCHS):</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a><span class="co">#         for x, y in train_loader:</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a><span class="co">#             x = x.to(DEVICE)</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a><span class="co">#             for idx in range(8):</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bboxes = cellboxes_to_boxes(model(x))</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a><span class="co">#                 bboxes = non_max_suppression(bboxes[idx], iou_threshold=0.5, threshold=0.4, box_format="midpoint")</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a><span class="co">#                 plot_image(x[idx].permute(1,2,0).to("cpu"), bboxes)</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a><span class="co">#             import sys</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a><span class="co">#             sys.exit()</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>        pred_boxes, target_boxes <span class="op">=</span> get_bboxes(</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>            train_loader, model, iou_threshold<span class="op">=</span><span class="fl">0.02</span>, threshold<span class="op">=</span><span class="fl">0.01</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>        mean_avg_prec <span class="op">=</span> mean_average_precision(</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>            pred_boxes, target_boxes, iou_threshold<span class="op">=</span><span class="fl">0.02</span>, box_format<span class="op">=</span><span class="st">"midpoint"</span></span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Train mAP: </span><span class="sc">{</span>mean_avg_prec<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mean_avg_prec <span class="op">&gt;</span> <span class="fl">0.9</span>:</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>            checkpoint <span class="op">=</span> {</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>               <span class="st">"state_dict"</span>: model.state_dict(),</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>               <span class="st">"optimizer"</span>: optimizer.state_dict(),</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>            save_checkpoint(checkpoint, filename<span class="op">=</span>LOAD_MODEL_FILE)</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>            <span class="im">import</span> time</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">10</span>)</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>        train_fn(train_loader, model, optimizer, loss_fn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="09ebed6f" class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>main()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>=&gt; Loading checkpoint</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_9519/1525986096.py:3: DeprecationWarning: __array__ implementation doesn't accept a copy keyword, so passing copy=False failed. __array__ must implement 'dtype' and 'copy' keyword arguments.
  im = np.array(image)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-8.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-41-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>An exception has occurred, use %tb to see the full traceback.

<span class="ansi-red-fg">SystemExit</span>
</pre>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/galopy/miniforge3/envs/fromscratch/lib/python3.12/site-packages/IPython/core/interactiveshell.py:3554: UserWarning: To exit: use 'exit', 'quit', or Ctrl-D.
  warn("To exit: use 'exit', 'quit', or Ctrl-D.", stacklevel=1)</code></pre>
</div>
</div>
<div id="62eaf214" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>train_loader <span class="op">=</span> DataLoader(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    dataset<span class="op">=</span>train_dataset,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>BATCH_SIZE,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    num_workers<span class="op">=</span>NUM_WORKERS,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    pin_memory<span class="op">=</span>PIN_MEMORY,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    drop_last<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>xb, yb <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(train_loader))</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>xb.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([8, 3, 448, 448])</code></pre>
</div>
</div>
<div id="4508a372" class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Yolov1(split_size<span class="op">=</span><span class="dv">7</span>, num_boxes<span class="op">=</span><span class="dv">2</span>, num_classes<span class="op">=</span><span class="dv">20</span>).to(DEVICE)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span>LEARNING_RATE, weight_decay<span class="op">=</span>WEIGHT_DECAY)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>loss_fn <span class="op">=</span> YoloLoss()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Inside <a href="https://galopyz.github.io/pilus_project/yolov1.html#get_bboxes"><code>get_bboxes</code></a>.</p>
<div id="2884f586" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>all_pred_boxes <span class="op">=</span> []</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>all_true_boxes <span class="op">=</span> []</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>train_idx <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1a0e5d6d" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>xb, yb <span class="op">=</span> <span class="bu">next</span>(<span class="bu">iter</span>(train_loader))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad(): </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> model(xb)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>bs <span class="op">=</span> xb.shape[<span class="dv">0</span>]</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>bs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>8</code></pre>
</div>
</div>
<div id="f89b3bf2" class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>yb.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([8, 7, 7, 30])</code></pre>
</div>
</div>
<div id="9bd660e6" class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>yb[<span class="dv">0</span>][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
         0., 0., 0., 0., 0., 0.]])</code></pre>
</div>
</div>
<div id="efed534e" class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>true_bboxes <span class="op">=</span> cellboxes_to_boxes(yb)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>torch.tensor(true_bboxes).shape, true_bboxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([8, 49, 6]),
 [[[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [7.0,
    1.0,
    0.48842108249664307,
    0.512499988079071,
    0.8294737339019775,
    0.9458333849906921],
   [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
   [6.0,
    1.0,
    0.6390000581741333,
    0.5675675868988037,
    0.718000054359436,
    0.8408408761024475],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [7.0,
    1.0,
    0.27500003576278687,
    0.4933333694934845,
    0.5099999904632568,
    0.3893333673477173],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
   [7.0,
    1.0,
    0.7120000720024109,
    0.4560000002384186,
    0.5040000677108765,
    0.4480000436306],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [14.0,
    1.0,
    0.37700000405311584,
    0.5640000104904175,
    0.15800002217292786,
    0.3813333213329315],
   [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [12.0,
    1.0,
    0.3370000422000885,
    0.6666667461395264,
    0.4020000398159027,
    0.421333372592926],
   [14.0,
    1.0,
    0.5529999732971191,
    0.7000000476837158,
    0.07800000160932541,
    0.34933337569236755],
   [14.0,
    1.0,
    0.6100000143051147,
    0.7066667079925537,
    0.08400000631809235,
    0.34666669368743896],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [14.0,
    1.0,
    0.3184524178504944,
    0.445000022649765,
    0.369047611951828,
    0.5659999847412109],
   [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
   [14.0,
    1.0,
    0.80952388048172,
    0.515999972820282,
    0.3750000298023224,
    0.8920000195503235],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [11.0,
    1.0,
    0.269345223903656,
    0.6210000514984131,
    0.538690447807312,
    0.3059999942779541],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [6.0,
    1.0,
    0.5360000133514404,
    0.5619999766349792,
    0.9013333916664124,
    0.5360000133514404],
   [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.4285714626312256, 0.0, 0.0],
   [1.0,
    1.0,
    0.5913174152374268,
    0.5429999828338623,
    0.6377246379852295,
    0.8019999861717224],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]],
  [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
   [14.0,
    1.0,
    0.514970064163208,
    0.4610000252723694,
    0.5928143858909607,
    0.9220000505447388],
   [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
   [14.0,
    1.0,
    0.8742515444755554,
    0.5040000677108765,
    0.24550898373126984,
    0.9360000491142273],
   [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
   [1.0,
    1.0,
    0.48353296518325806,
    0.7000000476837158,
    0.5538922548294067,
    0.5960000157356262],
   [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
   [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
   [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]]])</code></pre>
</div>
</div>
<div id="bfad1b36" class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>bboxes <span class="op">=</span> cellboxes_to_boxes(preds)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>torch.tensor(bboxes).shape, bboxes[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([8, 49, 6]),
 [[3.0,
   0.05791360139846802,
   0.03071294166147709,
   -0.002517323475331068,
   -0.031728584319353104,
   0.006539730355143547],
  [19.0,
   0.10828172415494919,
   0.14756271243095398,
   -0.016582747921347618,
   -0.008299557492136955,
   0.01615554839372635],
  [13.0,
   0.11980977654457092,
   0.274875670671463,
   -0.018651630729436874,
   0.002111813984811306,
   -0.0005199417355470359],
  [8.0,
   -0.017549633979797363,
   0.4419444799423218,
   0.017682278528809547,
   -0.02853921242058277,
   -0.005208893679082394],
  [14.0,
   -0.09938158094882965,
   0.5583432912826538,
   0.012327528558671474,
   0.0098693473264575,
   -0.005102234892547131],
  [0.0,
   0.043295688927173615,
   0.7186535596847534,
   -0.02858358807861805,
   0.01633009873330593,
   0.01354031078517437],
  [7.0,
   0.10642781108617783,
   0.8594925999641418,
   0.023684890940785408,
   0.000150596461025998,
   0.01613001897931099],
  [12.0,
   -0.038706738501787186,
   -0.004942918661981821,
   0.14616219699382782,
   0.004356366582214832,
   0.010153576731681824],
  [14.0,
   0.21250739693641663,
   0.16930755972862244,
   0.1576453000307083,
   0.012522163800895214,
   0.007855117321014404],
  [18.0,
   0.27751728892326355,
   0.2996690273284912,
   0.14025703072547913,
   0.007530116941779852,
   0.05020694062113762],
  [18.0,
   -0.09983375668525696,
   0.422551691532135,
   0.1549568474292755,
   -0.018472790718078613,
   -0.013049599714577198],
  [15.0,
   0.15368522703647614,
   0.5565087795257568,
   0.1547100841999054,
   -0.02206183224916458,
   -0.023390311747789383],
  [17.0,
   0.03610345348715782,
   0.7166946530342102,
   0.1297713816165924,
   -0.022036131471395493,
   -0.021519459784030914],
  [6.0,
   -0.05443115159869194,
   0.8743669986724854,
   0.1744801551103592,
   -0.03472127765417099,
   -0.0062321024015545845],
  [17.0,
   0.10258059948682785,
   -0.010206078179180622,
   0.313591867685318,
   -4.80264461657498e-05,
   -0.003143869573250413],
  [0.0,
   -0.08548567444086075,
   0.12012486159801483,
   0.2796362042427063,
   0.004561031237244606,
   0.002124300692230463],
  [10.0,
   0.03864534944295883,
   0.27717122435569763,
   0.27682626247406006,
   0.008075060322880745,
   -0.023886417970061302],
  [5.0,
   0.2954280972480774,
   0.45058658719062805,
   0.27115803956985474,
   -0.010309206321835518,
   -0.0008604415343143046],
  [14.0,
   0.14327624440193176,
   0.5665556788444519,
   0.29179930686950684,
   -0.007074080873280764,
   0.0006725640851072967],
  [4.0,
   0.15265095233917236,
   0.7188976407051086,
   0.2754635214805603,
   0.052837397903203964,
   0.009571452625095844],
  [19.0,
   0.033910904079675674,
   0.8498724102973938,
   0.2897896468639374,
   -0.00971283484250307,
   0.0009967128280550241],
  [0.0,
   0.0817124992609024,
   -0.03051653690636158,
   0.4207684397697449,
   0.03483124449849129,
   -0.03289015218615532],
  [1.0,
   0.1646699458360672,
   0.144572451710701,
   0.4251202344894409,
   -0.025422310456633568,
   0.012480674311518669],
  [5.0,
   0.022091789171099663,
   0.30300432443618774,
   0.4436083436012268,
   0.00196900125592947,
   0.008539533242583275],
  [9.0,
   0.219450443983078,
   0.41262227296829224,
   0.40972524881362915,
   0.00021286522678565234,
   0.0021240711212158203],
  [5.0,
   0.17189453542232513,
   0.5787466168403625,
   0.4193178713321686,
   -0.0028356367256492376,
   0.014560356736183167],
  [14.0,
   0.07297457009553909,
   0.7370981574058533,
   0.43873345851898193,
   0.037759847939014435,
   -0.01427136454731226],
  [0.0,
   0.05240419879555702,
   0.8634119033813477,
   0.41575559973716736,
   0.006404500920325518,
   -0.04177410528063774],
  [2.0,
   -0.004385566338896751,
   -0.008994175121188164,
   0.5881887674331665,
   0.0008479586103931069,
   0.0074990433640778065],
  [10.0,
   0.06491167843341827,
   0.13655878603458405,
   0.5514402389526367,
   0.010271313600242138,
   -0.010734865441918373],
  [9.0,
   0.14303606748580933,
   0.2990753650665283,
   0.5501272082328796,
   -0.020976949483156204,
   0.0012839926639571786],
  [5.0,
   0.07218076288700104,
   0.4433569014072418,
   0.6036580204963684,
   0.010148609057068825,
   -0.027454784139990807],
  [13.0,
   -0.07835759222507477,
   0.564740777015686,
   0.5779457092285156,
   -0.017660876736044884,
   0.015681717544794083],
  [19.0,
   -0.09923414885997772,
   0.7411959767341614,
   0.5936504602432251,
   -0.0007167485309764743,
   0.026969926431775093],
  [11.0,
   -0.048919014632701874,
   0.8472048044204712,
   0.5756462216377258,
   -0.01894926279783249,
   -0.006600611377507448],
  [19.0,
   -0.013136878609657288,
   0.017893746495246887,
   0.7153540849685669,
   0.0030052566435188055,
   0.01996099390089512],
  [10.0,
   0.04731687158346176,
   0.12658247351646423,
   0.7114074230194092,
   0.03029739484190941,
   0.03333675116300583],
  [3.0,
   0.08107434213161469,
   0.2924124598503113,
   0.7183541655540466,
   0.0018420539563521743,
   0.009252648800611496],
  [14.0,
   0.03232689946889877,
   0.4424069821834564,
   0.7288557291030884,
   0.012216808274388313,
   0.013487100601196289],
  [15.0,
   -0.03617287054657936,
   0.558650016784668,
   0.6989643573760986,
   0.021594980731606483,
   -0.007387370802462101],
  [1.0,
   0.08664897829294205,
   0.6988940834999084,
   0.7042855024337769,
   0.0118038235232234,
   0.02734706737101078],
  [8.0,
   -0.012789484113454819,
   0.857683002948761,
   0.7068489789962769,
   0.010791255161166191,
   0.01531668845564127],
  [11.0,
   -0.013756664469838142,
   -0.00892128050327301,
   0.8778007626533508,
   -0.00830551516264677,
   -0.03716181591153145],
  [18.0,
   0.079897940158844,
   0.1574002504348755,
   0.8666889071464539,
   0.0021867933683097363,
   0.012636973522603512],
  [10.0,
   -0.0983617976307869,
   0.3015250861644745,
   0.852695107460022,
   0.012542926706373692,
   -0.0005891781183890998],
  [17.0,
   -0.036439429968595505,
   0.4322212040424347,
   0.8630614280700684,
   0.0073834192007780075,
   -0.009754224680364132],
  [14.0,
   -0.013987917453050613,
   0.5865940451622009,
   0.8550401329994202,
   0.014219784177839756,
   -0.01609755866229534],
  [13.0,
   -0.011934658512473106,
   0.6608523726463318,
   0.8428880572319031,
   -0.013302735053002834,
   -0.009596243500709534],
  [17.0,
   0.0019228123128414154,
   0.8482473492622375,
   0.840347409248352,
   0.006790795363485813,
   0.0356440469622612]])</code></pre>
</div>
</div>
<div id="d790d8b3" class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(bboxes[<span class="dv">0</span>]) <span class="co"># 1 per each cell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>49</code></pre>
</div>
</div>
<div id="a92cf56a" class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>box_format <span class="op">=</span> <span class="st">'midpoint'</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>iou_threshold <span class="op">=</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cfa06d56" class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>nms_boxes <span class="op">=</span> non_max_suppression(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    bboxes[idx],</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    iou_threshold<span class="op">=</span>iou_threshold,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    threshold<span class="op">=</span>threshold,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    box_format<span class="op">=</span>box_format,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>nms_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[5.0,
  0.2954280972480774,
  0.45058658719062805,
  0.27115803956985474,
  -0.010309206321835518,
  -0.0008604415343143046],
 [18.0,
  0.27751728892326355,
  0.2996690273284912,
  0.14025703072547913,
  0.007530116941779852,
  0.05020694062113762],
 [9.0,
  0.219450443983078,
  0.41262227296829224,
  0.40972524881362915,
  0.00021286522678565234,
  0.0021240711212158203],
 [14.0,
  0.21250739693641663,
  0.16930755972862244,
  0.1576453000307083,
  0.012522163800895214,
  0.007855117321014404],
 [5.0,
  0.17189453542232513,
  0.5787466168403625,
  0.4193178713321686,
  -0.0028356367256492376,
  0.014560356736183167],
 [1.0,
  0.1646699458360672,
  0.144572451710701,
  0.4251202344894409,
  -0.025422310456633568,
  0.012480674311518669],
 [15.0,
  0.15368522703647614,
  0.5565087795257568,
  0.1547100841999054,
  -0.02206183224916458,
  -0.023390311747789383],
 [4.0,
  0.15265095233917236,
  0.7188976407051086,
  0.2754635214805603,
  0.052837397903203964,
  0.009571452625095844],
 [14.0,
  0.14327624440193176,
  0.5665556788444519,
  0.29179930686950684,
  -0.007074080873280764,
  0.0006725640851072967],
 [9.0,
  0.14303606748580933,
  0.2990753650665283,
  0.5501272082328796,
  -0.020976949483156204,
  0.0012839926639571786],
 [13.0,
  0.11980977654457092,
  0.274875670671463,
  -0.018651630729436874,
  0.002111813984811306,
  -0.0005199417355470359],
 [19.0,
  0.10828172415494919,
  0.14756271243095398,
  -0.016582747921347618,
  -0.008299557492136955,
  0.01615554839372635],
 [7.0,
  0.10642781108617783,
  0.8594925999641418,
  0.023684890940785408,
  0.000150596461025998,
  0.01613001897931099],
 [17.0,
  0.10258059948682785,
  -0.010206078179180622,
  0.313591867685318,
  -4.80264461657498e-05,
  -0.003143869573250413]]</code></pre>
</div>
</div>
<div id="08ae06f6" class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>plot_image(xb[idx].permute(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>).to(<span class="st">"cpu"</span>), nms_boxes)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(nms_boxes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[5.0, 0.2954280972480774, 0.45058658719062805, 0.27115803956985474, -0.010309206321835518, -0.0008604415343143046], [18.0, 0.27751728892326355, 0.2996690273284912, 0.14025703072547913, 0.007530116941779852, 0.05020694062113762], [9.0, 0.219450443983078, 0.41262227296829224, 0.40972524881362915, 0.00021286522678565234, 0.0021240711212158203], [14.0, 0.21250739693641663, 0.16930755972862244, 0.1576453000307083, 0.012522163800895214, 0.007855117321014404], [5.0, 0.17189453542232513, 0.5787466168403625, 0.4193178713321686, -0.0028356367256492376, 0.014560356736183167], [1.0, 0.1646699458360672, 0.144572451710701, 0.4251202344894409, -0.025422310456633568, 0.012480674311518669], [15.0, 0.15368522703647614, 0.5565087795257568, 0.1547100841999054, -0.02206183224916458, -0.023390311747789383], [4.0, 0.15265095233917236, 0.7188976407051086, 0.2754635214805603, 0.052837397903203964, 0.009571452625095844], [14.0, 0.14327624440193176, 0.5665556788444519, 0.29179930686950684, -0.007074080873280764, 0.0006725640851072967], [9.0, 0.14303606748580933, 0.2990753650665283, 0.5501272082328796, -0.020976949483156204, 0.0012839926639571786], [13.0, 0.11980977654457092, 0.274875670671463, -0.018651630729436874, 0.002111813984811306, -0.0005199417355470359], [19.0, 0.10828172415494919, 0.14756271243095398, -0.016582747921347618, -0.008299557492136955, 0.01615554839372635], [7.0, 0.10642781108617783, 0.8594925999641418, 0.023684890940785408, 0.000150596461025998, 0.01613001897931099], [17.0, 0.10258059948682785, -0.010206078179180622, 0.313591867685318, -4.80264461657498e-05, -0.003143869573250413]]</code></pre>
</div>
</div>
<div id="db2ef25d" class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nms_box <span class="kw">in</span> nms_boxes:</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    all_pred_boxes.append([train_idx] <span class="op">+</span> nms_box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ce943edf" class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>all_pred_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0,
  5.0,
  0.2954280972480774,
  0.45058658719062805,
  0.27115803956985474,
  -0.010309206321835518,
  -0.0008604415343143046],
 [0,
  18.0,
  0.27751728892326355,
  0.2996690273284912,
  0.14025703072547913,
  0.007530116941779852,
  0.05020694062113762],
 [0,
  9.0,
  0.219450443983078,
  0.41262227296829224,
  0.40972524881362915,
  0.00021286522678565234,
  0.0021240711212158203],
 [0,
  14.0,
  0.21250739693641663,
  0.16930755972862244,
  0.1576453000307083,
  0.012522163800895214,
  0.007855117321014404],
 [0,
  5.0,
  0.17189453542232513,
  0.5787466168403625,
  0.4193178713321686,
  -0.0028356367256492376,
  0.014560356736183167],
 [0,
  1.0,
  0.1646699458360672,
  0.144572451710701,
  0.4251202344894409,
  -0.025422310456633568,
  0.012480674311518669],
 [0,
  15.0,
  0.15368522703647614,
  0.5565087795257568,
  0.1547100841999054,
  -0.02206183224916458,
  -0.023390311747789383],
 [0,
  4.0,
  0.15265095233917236,
  0.7188976407051086,
  0.2754635214805603,
  0.052837397903203964,
  0.009571452625095844],
 [0,
  14.0,
  0.14327624440193176,
  0.5665556788444519,
  0.29179930686950684,
  -0.007074080873280764,
  0.0006725640851072967],
 [0,
  9.0,
  0.14303606748580933,
  0.2990753650665283,
  0.5501272082328796,
  -0.020976949483156204,
  0.0012839926639571786],
 [0,
  13.0,
  0.11980977654457092,
  0.274875670671463,
  -0.018651630729436874,
  0.002111813984811306,
  -0.0005199417355470359],
 [0,
  19.0,
  0.10828172415494919,
  0.14756271243095398,
  -0.016582747921347618,
  -0.008299557492136955,
  0.01615554839372635],
 [0,
  7.0,
  0.10642781108617783,
  0.8594925999641418,
  0.023684890940785408,
  0.000150596461025998,
  0.01613001897931099],
 [0,
  17.0,
  0.10258059948682785,
  -0.010206078179180622,
  0.313591867685318,
  -4.80264461657498e-05,
  -0.003143869573250413]]</code></pre>
</div>
</div>
<div id="74c22dcc" class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>true_bboxes[idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
 [7.0,
  1.0,
  0.48842108249664307,
  0.512499988079071,
  0.8294737339019775,
  0.9458333849906921],
 [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]]</code></pre>
</div>
</div>
<div id="1edf07ab" class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> box <span class="kw">in</span> true_bboxes[idx]:</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># many will get converted to 0 pred</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> box[<span class="dv">1</span>] <span class="op">&gt;</span> threshold:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>        all_true_boxes.append([train_idx] <span class="op">+</span> box)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additional train_idx is added for <code>all_true_boxes</code>.</p>
<div id="1e49c1c1" class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>all_true_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0,
  7.0,
  1.0,
  0.48842108249664307,
  0.512499988079071,
  0.8294737339019775,
  0.9458333849906921]]</code></pre>
</div>
</div>
<div id="d365045b" class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(true_bboxes[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>49</code></pre>
</div>
</div>
<div id="d8622641" class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>true_bboxes[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.0, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.1428571492433548, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.2857142984867096, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.4285714626312256, 0.0, 0.0],
 [7.0,
  1.0,
  0.48842108249664307,
  0.512499988079071,
  0.8294737339019775,
  0.9458333849906921],
 [0.0, 0.0, 0.5714285969734192, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.4285714626312256, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.5714285969734192, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.7142857313156128, 0.0, 0.0],
 [0.0, 0.0, 0.0, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.1428571492433548, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.2857142984867096, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.4285714626312256, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.5714285969734192, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.7142857313156128, 0.8571429252624512, 0.0, 0.0],
 [0.0, 0.0, 0.8571429252624512, 0.8571429252624512, 0.0, 0.0]]</code></pre>
</div>
</div>
<div id="45b3294c" class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>plot_image(xb[<span class="dv">0</span>], true_bboxes[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-61-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ed5f9653" class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>plot_image(xb[<span class="dv">0</span>], [all_true_boxes[<span class="dv">0</span>][<span class="dv">1</span>:]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="53_yolov1_files/figure-html/cell-62-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="41c0782c" class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>pred_boxes, target_boxes <span class="op">=</span> get_bboxes(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    train_loader, model, iou_threshold<span class="op">=</span><span class="fl">0.5</span>, threshold<span class="op">=</span><span class="fl">0.</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>pred_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0,
  16.0,
  0.04880784451961517,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014819064177573,
  -0.0005609018262475729],
 [0,
  18.0,
  0.04596563056111336,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246645352803171,
  0.0013500609202310443],
 [0,
  5.0,
  0.04222836345434189,
  0.43169596791267395,
  0.852234423160553,
  0.0015447199111804366,
  -2.0928358935634606e-05],
 [0,
  17.0,
  0.04152437299489975,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269533753395,
  0.002315293299034238],
 [0,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880215214565396,
  -0.0007841718033887446],
 [0,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326733890920877,
  0.006220615468919277,
  0.00047305849147960544],
 [0,
  11.0,
  0.03548029810190201,
  0.5692073702812195,
  0.28337833285331726,
  0.00324416090734303,
  0.0029634027741849422],
 [0,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.00097929616458714,
  -0.002543338108807802],
 [0,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.002076603937894106,
  -0.0033999979496002197],
 [0,
  1.0,
  0.03337988629937172,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973265981301665,
  -0.002992372727021575],
 [0,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.006441280711442232,
  -0.005959640722721815],
 [0,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895781237632036,
  0.0051577650010585785],
 [0,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.004679890815168619],
 [0,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847196161747,
  -0.007043744437396526],
 [0,
  17.0,
  0.02896946668624878,
  0.5695548057556152,
  0.7205935716629028,
  -0.005785795394331217,
  -0.0018508632201701403],
 [0,
  19.0,
  0.02833571285009384,
  0.42402884364128113,
  0.0008106034365482628,
  -0.005690244026482105,
  -0.005403212737292051],
 [0,
  7.0,
  0.027755150571465492,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729636687785387,
  0.0061393859796226025],
 [0,
  11.0,
  0.02739958092570305,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143691312521696,
  0.005311156623065472],
 [0,
  17.0,
  0.027385598048567772,
  0.002377033932134509,
  -0.007107321172952652,
  -0.004745279438793659,
  0.005192494951188564],
 [0,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.001242348924279213,
  0.0039032401982694864],
 [0,
  3.0,
  0.02587714046239853,
  0.5747456550598145,
  -0.0007388428202830255,
  0.002270226599648595,
  -0.004265402909368277],
 [0,
  10.0,
  0.025490777567029,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.0031593304593116045],
 [0,
  1.0,
  0.02135799638926983,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027908533812],
 [0,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.005262696649879217,
  0.0020898065995424986,
  -0.0055968184024095535],
 [0,
  15.0,
  0.018854616209864616,
  -0.0022594714537262917,
  0.1384880095720291,
  0.002785480348393321,
  0.005815902724862099],
 [0,
  12.0,
  0.018164731562137604,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829452658072114,
  0.002220866968855262],
 [0,
  10.0,
  0.017963578924536705,
  0.13925801217556,
  0.5659564137458801,
  0.0021879379637539387,
  0.0050342148169875145],
 [0,
  19.0,
  0.01641383208334446,
  0.42223626375198364,
  0.4327896535396576,
  -0.0001622691488591954,
  -0.005205052439123392],
 [0,
  3.0,
  0.013968080282211304,
  0.5662983655929565,
  0.8560060262680054,
  0.0054604667238891125,
  0.003514510579407215],
 [0,
  19.0,
  0.010167022235691547,
  0.5683696269989014,
  0.5717867016792297,
  -0.001429215306416154,
  -0.004541652277112007],
 [0,
  11.0,
  0.009437758475542068,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314248450100422,
  -0.005225767381489277],
 [0,
  5.0,
  0.00882111955434084,
  0.14858995378017426,
  0.8628853559494019,
  -0.0027583171613514423,
  0.0005774053279310465],
 [0,
  4.0,
  0.007675145287066698,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203427946195006,
  -0.0008360185893252492],
 [0,
  17.0,
  0.007499024271965027,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506203493103385,
  -0.0004903242806904018],
 [0,
  15.0,
  0.0074683791026473045,
  0.2914716899394989,
  0.7104690074920654,
  -0.0004536565684247762,
  -0.002246222924441099],
 [0,
  17.0,
  0.0066661536693573,
  0.7089016437530518,
  0.14547641575336456,
  -0.0025538974441587925,
  0.002486427780240774],
 [0,
  2.0,
  0.004264902323484421,
  0.5711851119995117,
  0.43296027183532715,
  0.0026889850851148367,
  0.006471899338066578],
 [0,
  5.0,
  0.004250847734510899,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021460285410285],
 [0,
  17.0,
  0.0005488770548254251,
  0.0021971387322992086,
  0.5736400485038757,
  -0.002658810233697295,
  -0.0026629820931702852],
 [1,
  16.0,
  0.04880784451961517,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014785594772547,
  -0.0005609014187939465],
 [1,
  18.0,
  0.04596563056111336,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246644770726562,
  0.0013500612694770098],
 [1,
  5.0,
  0.04222835972905159,
  0.43169596791267395,
  0.852234423160553,
  0.001544719678349793,
  -2.092861723212991e-05],
 [1,
  17.0,
  0.04152438044548035,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269533753395,
  0.002315293299034238],
 [1,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880215214565396,
  -0.0007841720362193882],
 [1,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326736219227314,
  0.00622061500325799,
  0.00047305799671448767],
 [1,
  11.0,
  0.035480301827192307,
  0.5692073702812195,
  0.28337833285331726,
  0.0032441611401736736,
  0.0029634027741849422],
 [1,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792958153411746,
  -0.002543337643146515],
 [1,
  2.0,
  0.03432384133338928,
  0.2915676236152649,
  0.27988576889038086,
  0.002076603937894106,
  -0.0033999979496002197],
 [1,
  1.0,
  0.03337988257408142,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973264817148447,
  -0.0029923724941909313],
 [1,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.006441280711442232,
  -0.005959640722721815],
 [1,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895783565938473,
  0.0051577650010585785],
 [1,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.004679890815168619],
 [1,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847196161747,
  -0.007043743971735239],
 [1,
  17.0,
  0.02896946482360363,
  0.5695548057556152,
  0.7205935716629028,
  -0.0057857949286699295,
  -0.001850863453000784],
 [1,
  19.0,
  0.02833571657538414,
  0.42402884364128113,
  0.0008106034947559237,
  -0.005690244026482105,
  -0.005403212737292051],
 [1,
  7.0,
  0.027755150571465492,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729632031172514,
  0.0061393859796226025],
 [1,
  11.0,
  0.02739957720041275,
  -0.00334669416770339,
  0.43197140097618103,
  0.0022143693640828133,
  0.005311157088726759],
 [1,
  17.0,
  0.027385596185922623,
  0.0023770341649651527,
  -0.007107321638613939,
  -0.004745279438793659,
  0.005192494951188564],
 [1,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.001242348924279213,
  0.0039032401982694864],
 [1,
  3.0,
  0.02587714046239853,
  0.5747456550598145,
  -0.000738843169528991,
  0.0022702268324792385,
  -0.004265402909368277],
 [1,
  10.0,
  0.025490777567029,
  0.2899598479270935,
  0.8518151640892029,
  0.004068488720804453,
  0.0031593304593116045],
 [1,
  1.0,
  0.02135799266397953,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027908533812],
 [1,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.005262696649879217,
  0.002089806366711855,
  -0.0055968184024095535],
 [1,
  15.0,
  0.018854618072509766,
  -0.0022594714537262917,
  0.1384880095720291,
  0.002785480348393321,
  0.005815902724862099],
 [1,
  12.0,
  0.018164731562137604,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829451493918896,
  0.002220866270363331],
 [1,
  10.0,
  0.017963578924536705,
  0.13925801217556,
  0.5659564137458801,
  0.0021879374980926514,
  0.0050342148169875145],
 [1,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226922161877155,
  -0.005205052439123392],
 [1,
  3.0,
  0.013968082144856453,
  0.5662983655929565,
  0.8560060262680054,
  0.0054604667238891125,
  0.003514510579407215],
 [1,
  19.0,
  0.010167023167014122,
  0.5683696269989014,
  0.5717867016792297,
  -0.001429215190000832,
  -0.00454165181145072],
 [1,
  11.0,
  0.00943775661289692,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314248450100422,
  -0.005225767381489277],
 [1,
  5.0,
  0.008821118623018265,
  0.14858995378017426,
  0.8628853559494019,
  -0.002758317394182086,
  0.000577404978685081],
 [1,
  4.0,
  0.007675145752727985,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203430274501443,
  -0.0008360186475329101],
 [1,
  17.0,
  0.007499022409319878,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506204657256603,
  -0.0004903244553133845],
 [1,
  15.0,
  0.007468376308679581,
  0.2914716899394989,
  0.7104690074920654,
  -0.00045365694677457213,
  -0.0022462226916104555],
 [1,
  17.0,
  0.0066661536693573,
  0.7089016437530518,
  0.14547641575336456,
  -0.002553897676989436,
  0.0024864287115633488],
 [1,
  2.0,
  0.004264902789145708,
  0.5711851119995117,
  0.43296027183532715,
  0.002688985550776124,
  0.006471899803727865],
 [1,
  5.0,
  0.004250846803188324,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021459121257067],
 [1,
  17.0,
  0.0005488756578415632,
  0.0021971389651298523,
  0.5736400485038757,
  -0.002658810233697295,
  -0.0026629820931702852],
 [2,
  16.0,
  0.04880784451961517,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014816153794527,
  -0.0005609015352092683],
 [2,
  18.0,
  0.04596563056111336,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246645352803171,
  0.0013500605709850788],
 [2,
  5.0,
  0.04222836345434189,
  0.43169596791267395,
  0.852234423160553,
  0.0015447199111804366,
  -2.092866816383321e-05],
 [2,
  17.0,
  0.04152437299489975,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269068092108,
  0.0023152935318648815],
 [2,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880210557952523,
  -0.0007841719198040664],
 [2,
  10.0,
  0.03657899424433708,
  0.28723227977752686,
  0.0019326737383380532,
  0.006220615468919277,
  0.00047305840416811407],
 [2,
  11.0,
  0.035480301827192307,
  0.5692073702812195,
  0.28337833285331726,
  0.00324416090734303,
  0.002963403007015586],
 [2,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792958153411746,
  -0.002543338807299733],
 [2,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766041707247496,
  -0.0033999981824308634],
 [2,
  1.0,
  0.03337988257408142,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973268309608102,
  -0.0029923722613602877],
 [2,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.00595964165404439],
 [2,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895783565938473,
  0.0051577650010585785],
 [2,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.002351201605051756,
  0.0046798912808299065],
 [2,
  0.0,
  0.030840158462524414,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847196161747,
  -0.007043743971735239],
 [2,
  17.0,
  0.02896946296095848,
  0.5695548057556152,
  0.7205935716629028,
  -0.005785795394331217,
  -0.001850863336585462],
 [2,
  19.0,
  0.02833571471273899,
  0.42402884364128113,
  0.0008106032619252801,
  -0.005690244026482105,
  -0.005403212737292051],
 [2,
  7.0,
  0.027755148708820343,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729632031172514,
  0.0061393859796226025],
 [2,
  11.0,
  0.0273995790630579,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143691312521696,
  0.005311156623065472],
 [2,
  17.0,
  0.027385596185922623,
  0.002377033932134509,
  -0.007107321172952652,
  -0.004745279438793659,
  0.005192495416849852],
 [2,
  10.0,
  0.026400703936815262,
  0.7067244052886963,
  0.855017364025116,
  -0.0012423492735251784,
  0.00390324043110013],
 [2,
  3.0,
  0.02587713859975338,
  0.5747456550598145,
  -0.0007388427620753646,
  0.002270226599648595,
  -0.004265402909368277],
 [2,
  10.0,
  0.02549077942967415,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.0031593304593116045],
 [2,
  1.0,
  0.02135799452662468,
  0.13988235592842102,
  0.4246824383735657,
  -0.0052095134742558,
  0.004185027442872524],
 [2,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.005262696649879217,
  0.0020898065995424986,
  -0.005596817936748266],
 [2,
  15.0,
  0.018854618072509766,
  -0.002259471220895648,
  0.1384880095720291,
  0.0027854801155626774,
  0.005815903190523386],
 [2,
  12.0,
  0.018164733424782753,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829451493918896,
  0.002220866736024618],
 [2,
  10.0,
  0.017963578924536705,
  0.13925801217556,
  0.5659564137458801,
  0.0021879372652620077,
  0.0050342148169875145],
 [2,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226903244387358,
  -0.005205052439123392],
 [2,
  3.0,
  0.013968079350888729,
  0.5662983655929565,
  0.8560060262680054,
  0.0054604667238891125,
  0.003514510579407215],
 [2,
  19.0,
  0.010167024098336697,
  0.5683696269989014,
  0.5717867016792297,
  -0.001429215306416154,
  -0.004541652277112007],
 [2,
  11.0,
  0.00943775661289692,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314247984439135,
  -0.005225767381489277],
 [2,
  5.0,
  0.008821121416985989,
  0.14858995378017426,
  0.8628853559494019,
  -0.002758317394182086,
  0.0005774049204774201],
 [2,
  4.0,
  0.007675147615373135,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203427946195006,
  -0.0008360185311175883],
 [2,
  17.0,
  0.007499023340642452,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506205821409822,
  -0.0004903243388980627],
 [2,
  15.0,
  0.00746837817132473,
  0.2914716899394989,
  0.7104690074920654,
  -0.00045365680125541985,
  -0.002246222924441099],
 [2,
  17.0,
  0.006666155532002449,
  0.7089016437530518,
  0.14547641575336456,
  -0.00255389790982008,
  0.0024864282459020615],
 [2,
  2.0,
  0.004264901392161846,
  0.5711851119995117,
  0.43296027183532715,
  0.002688985550776124,
  0.006471899803727865],
 [2,
  5.0,
  0.004250846803188324,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021460867486894],
 [2,
  17.0,
  0.0005488754250109196,
  0.0021971387322992086,
  0.5736400485038757,
  -0.002658810233697295,
  -0.002662982326000929],
 [3,
  16.0,
  0.04880784451961517,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014829250518233,
  -0.0005609014770016074],
 [3,
  18.0,
  0.04596563056111336,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246644770726562,
  0.0013500606874004006],
 [3,
  5.0,
  0.04222835972905159,
  0.43169596791267395,
  0.852234423160553,
  0.001544719678349793,
  -2.0928830053890124e-05],
 [3,
  17.0,
  0.04152437672019005,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269068092108,
  0.0023152935318648815],
 [3,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.001588021288625896,
  -0.00078417151235044],
 [3,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326735055074096,
  0.00622061500325799,
  0.00047305820044130087],
 [3,
  11.0,
  0.035480301827192307,
  0.5692073702812195,
  0.28337833285331726,
  0.0032441606745123863,
  0.002963403007015586],
 [3,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792959317564964,
  -0.002543338341638446],
 [3,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766044035553932,
  -0.0033999981824308634],
 [3,
  1.0,
  0.03337988257408142,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973265981301665,
  -0.0029923722613602877],
 [3,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.005959640257060528],
 [3,
  0.0,
  0.03252032399177551,
  0.720090925693512,
  0.2873821258544922,
  0.0030895783565938473,
  0.0051577650010585785],
 [3,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.0046798912808299065],
 [3,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847196161747,
  -0.007043743971735239],
 [3,
  17.0,
  0.02896946296095848,
  0.5695548057556152,
  0.7205935716629028,
  -0.005785795394331217,
  -0.001850863336585462],
 [3,
  19.0,
  0.02833571657538414,
  0.42402884364128113,
  0.0008106034365482628,
  -0.005690244026482105,
  -0.005403212737292051],
 [3,
  7.0,
  0.027755148708820343,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729632031172514,
  0.006139385513961315],
 [3,
  11.0,
  0.0273995790630579,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143693640828133,
  0.005311156157404184],
 [3,
  17.0,
  0.027385598048567772,
  0.002377033932134509,
  -0.007107321172952652,
  -0.004745279438793659,
  0.005192495416849852],
 [3,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.0012423486914485693,
  0.0039032401982694864],
 [3,
  3.0,
  0.02587713673710823,
  0.5747456550598145,
  -0.0007388429949060082,
  0.002270226599648595,
  -0.004265402909368277],
 [3,
  10.0,
  0.025490777567029,
  0.2899598479270935,
  0.8518151640892029,
  0.004068488720804453,
  0.003159330226480961],
 [3,
  1.0,
  0.02135799452662468,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027442872524],
 [3,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.00526269618421793,
  0.002089806366711855,
  -0.0055968184024095535],
 [3,
  15.0,
  0.018854614347219467,
  -0.002259471220895648,
  0.1384880095720291,
  0.0027854805812239647,
  0.005815903190523386],
 [3,
  12.0,
  0.018164735287427902,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829456150531769,
  0.002220866736024618],
 [3,
  10.0,
  0.017963577061891556,
  0.13925801217556,
  0.5659564137458801,
  0.0021879379637539387,
  0.005034215748310089],
 [3,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226954176090658,
  -0.005205052439123392],
 [3,
  3.0,
  0.013968078419566154,
  0.5662983655929565,
  0.8560060262680054,
  0.005460468120872974,
  0.0035145103465765715],
 [3,
  19.0,
  0.010167025029659271,
  0.5683696269989014,
  0.5717867016792297,
  -0.0014292156556621194,
  -0.00454165181145072],
 [3,
  11.0,
  0.00943775661289692,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314247984439135,
  -0.005225767381489277],
 [3,
  5.0,
  0.008821120485663414,
  0.14858995378017426,
  0.8628853559494019,
  -0.0027583171613514423,
  0.0005774050951004028],
 [3,
  4.0,
  0.007675145287066698,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203426782041788,
  -0.0008360186475329101],
 [3,
  17.0,
  0.007499019615352154,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506204657256603,
  -0.0004903243971057236],
 [3,
  15.0,
  0.00746837817132473,
  0.2914716899394989,
  0.7104690074920654,
  -0.0004536568303592503,
  -0.002246223157271743],
 [3,
  17.0,
  0.006666154600679874,
  0.7089016437530518,
  0.14547641575336456,
  -0.002553898375481367,
  0.002486428013071418],
 [3,
  2.0,
  0.00426490418612957,
  0.5711851119995117,
  0.43296027183532715,
  0.002688985550776124,
  0.006471899803727865],
 [3,
  5.0,
  0.004250845406204462,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021460867486894],
 [3,
  17.0,
  0.0005488754250109196,
  0.0021971389651298523,
  0.5736400485038757,
  -0.0026588100008666515,
  -0.0026629820931702852],
 [4,
  16.0,
  0.048807840794324875,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014808877836913,
  -0.000560901768039912],
 [4,
  18.0,
  0.04596562683582306,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246648263186216,
  0.0013500606874004006],
 [4,
  5.0,
  0.04222836345434189,
  0.43169596791267395,
  0.852234423160553,
  0.001544719678349793,
  -2.0928697267663665e-05],
 [4,
  17.0,
  0.04152437299489975,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269068092108,
  0.002315293066203594],
 [4,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880210557952523,
  -0.0007841719780117273],
 [4,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326736219227314,
  0.00622061500325799,
  0.00047305814223363996],
 [4,
  11.0,
  0.03548029810190201,
  0.5692073702812195,
  0.28337833285331726,
  0.00324416090734303,
  0.0029634027741849422],
 [4,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792960481718183,
  -0.002543338341638446],
 [4,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766041707247496,
  -0.0033999981824308634],
 [4,
  1.0,
  0.03337988629937172,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973268309608102,
  -0.0029923724941909313],
 [4,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.005959640722721815],
 [4,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895781237632036,
  0.0051577650010585785],
 [4,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.002351201605051756,
  0.004679890815168619],
 [4,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847661823034,
  -0.007043743971735239],
 [4,
  17.0,
  0.02896946109831333,
  0.5695548057556152,
  0.7205935716629028,
  -0.005785795394331217,
  -0.001850863453000784],
 [4,
  19.0,
  0.02833571471273899,
  0.42402884364128113,
  0.0008106034947559237,
  -0.005690243560820818,
  -0.005403212737292051],
 [4,
  7.0,
  0.027755150571465492,
  0.14687421917915344,
  0.7170413136482239,
  -0.002872963435947895,
  0.0061393859796226025],
 [4,
  11.0,
  0.02739957720041275,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143691312521696,
  0.005311157088726759],
 [4,
  17.0,
  0.027385596185922623,
  0.0023770336993038654,
  -0.007107321172952652,
  -0.0047452799044549465,
  0.005192495416849852],
 [4,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.001242348924279213,
  0.0039032401982694864],
 [4,
  3.0,
  0.02587714232504368,
  0.5747456550598145,
  -0.0007388429366983473,
  0.002270226599648595,
  -0.004265402909368277],
 [4,
  10.0,
  0.025490777567029,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.0031593304593116045],
 [4,
  1.0,
  0.02135799452662468,
  0.13988235592842102,
  0.4246824383735657,
  -0.0052095134742558,
  0.004185027442872524],
 [4,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.005262696649879217,
  0.0020898065995424986,
  -0.005596817936748266],
 [4,
  15.0,
  0.018854618072509766,
  -0.0022594714537262917,
  0.1384880095720291,
  0.002785480348393321,
  0.005815902724862099],
 [4,
  12.0,
  0.018164735287427902,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829456150531769,
  0.0022208665031939745],
 [4,
  10.0,
  0.017963577061891556,
  0.13925801217556,
  0.5659564137458801,
  0.0021879374980926514,
  0.005034215282648802],
 [4,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226941079366952,
  -0.005205052439123392],
 [4,
  3.0,
  0.013968080282211304,
  0.5662983655929565,
  0.8560060262680054,
  0.005460467655211687,
  0.0035145108122378588],
 [4,
  19.0,
  0.010167024098336697,
  0.5683696269989014,
  0.5717867016792297,
  -0.0014292149571701884,
  -0.004541652277112007],
 [4,
  11.0,
  0.009437755681574345,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314248450100422,
  -0.005225767847150564],
 [4,
  5.0,
  0.008821118623018265,
  0.14858995378017426,
  0.8628853559494019,
  -0.002758317394182086,
  0.0005774050951004028],
 [4,
  4.0,
  0.007675147615373135,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203429110348225,
  -0.0008360188221558928],
 [4,
  17.0,
  0.007499021012336016,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506203493103385,
  -0.000490324106067419],
 [4,
  15.0,
  0.007468376774340868,
  0.2914716899394989,
  0.7104690074920654,
  -0.0004536567721515894,
  -0.002246222924441099],
 [4,
  17.0,
  0.006666155066341162,
  0.7089016437530518,
  0.14547641575336456,
  -0.00255389790982008,
  0.002486428013071418],
 [4,
  2.0,
  0.004264899529516697,
  0.5711851119995117,
  0.43296027183532715,
  0.0026889857836067677,
  0.006471899803727865],
 [4,
  5.0,
  0.004250845871865749,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021461449563503],
 [4,
  17.0,
  0.0005488754250109196,
  0.0021971389651298523,
  0.5736400485038757,
  -0.002658810233697295,
  -0.002662982326000929],
 [5,
  16.0,
  0.04880784451961517,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014821974560618,
  -0.0005609014770016074],
 [5,
  18.0,
  0.04596563056111336,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246648263186216,
  0.0013500608038157225],
 [5,
  5.0,
  0.04222836345434189,
  0.43169596791267395,
  0.852234423160553,
  0.0015447194455191493,
  -2.0928522644680925e-05],
 [5,
  17.0,
  0.04152437672019005,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269533753395,
  0.0023152935318648815],
 [5,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880210557952523,
  -0.0007841716869734228],
 [5,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326733890920877,
  0.00622061500325799,
  0.00047305834596045315],
 [5,
  11.0,
  0.035480301827192307,
  0.5692073702812195,
  0.28337833285331726,
  0.0032441611401736736,
  0.0029634027741849422],
 [5,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792959317564964,
  -0.002543338341638446],
 [5,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766041707247496,
  -0.0033999981824308634],
 [5,
  1.0,
  0.03337988629937172,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973267145454884,
  -0.0029923722613602877],
 [5,
  1.0,
  0.03324148803949356,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.005959640257060528],
 [5,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.00308957789093256,
  0.0051577650010585785],
 [5,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.0046798912808299065],
 [5,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847661823034,
  -0.007043743971735239],
 [5,
  17.0,
  0.02896946109831333,
  0.5695548057556152,
  0.7205935716629028,
  -0.0057857949286699295,
  -0.0018508632201701403],
 [5,
  19.0,
  0.02833571471273899,
  0.42402884364128113,
  0.000810603320132941,
  -0.005690243560820818,
  -0.005403212737292051],
 [5,
  7.0,
  0.027755146846175194,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729636687785387,
  0.0061393859796226025],
 [5,
  11.0,
  0.0273995790630579,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143691312521696,
  0.005311156157404184],
 [5,
  17.0,
  0.027385596185922623,
  0.002377033932134509,
  -0.007107321172952652,
  -0.0047452799044549465,
  0.005192495416849852],
 [5,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.0012423492735251784,
  0.00390324043110013],
 [5,
  3.0,
  0.02587714046239853,
  0.5747456550598145,
  -0.0007388429949060082,
  0.002270226599648595,
  -0.004265402909368277],
 [5,
  10.0,
  0.02549077570438385,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.003159330692142248],
 [5,
  1.0,
  0.02135799452662468,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027442872524],
 [5,
  4.0,
  0.0204045157879591,
  0.14101380109786987,
  -0.005262696649879217,
  0.0020898061338812113,
  -0.005596817936748266],
 [5,
  15.0,
  0.018854616209864616,
  -0.0022594714537262917,
  0.1384880095720291,
  0.002785480348393321,
  0.005815903190523386],
 [5,
  12.0,
  0.018164731562137604,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829452658072114,
  0.0022208665031939745],
 [5,
  10.0,
  0.017963578924536705,
  0.13925801217556,
  0.5659564137458801,
  0.0021879381965845823,
  0.005034215282648802],
 [5,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226967272814363,
  -0.005205052439123392],
 [5,
  3.0,
  0.013968081213533878,
  0.5662983655929565,
  0.8560060262680054,
  0.005460468120872974,
  0.0035145115107297897],
 [5,
  19.0,
  0.010167024098336697,
  0.5683696269989014,
  0.5717867016792297,
  -0.0014292154228314757,
  -0.004541652277112007],
 [5,
  11.0,
  0.009437757544219494,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314248450100422,
  -0.005225767847150564],
 [5,
  5.0,
  0.008821120485663414,
  0.14858995378017426,
  0.8628853559494019,
  -0.0027583171613514423,
  0.0005774052697233856],
 [5,
  4.0,
  0.007675145752727985,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203426782041788,
  -0.0008360188221558928],
 [5,
  17.0,
  0.007499020081013441,
  0.42597904801368713,
  0.7159280180931091,
  -0.001250620000064373,
  -0.000490324106067419],
 [5,
  15.0,
  0.0074683791026473045,
  0.2914716899394989,
  0.7104690074920654,
  -0.00045365694677457213,
  -0.002246222924441099],
 [5,
  17.0,
  0.0066661536693573,
  0.7089016437530518,
  0.14547641575336456,
  -0.00255389790982008,
  0.0024864282459020615],
 [5,
  2.0,
  0.004264900926500559,
  0.5711851119995117,
  0.43296027183532715,
  0.0026889850851148367,
  0.006471899803727865],
 [5,
  5.0,
  0.0042508491314947605,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021460867486894],
 [5,
  17.0,
  0.0005488761235028505,
  0.0021971387322992086,
  0.5736400485038757,
  -0.002658810233697295,
  -0.0026629820931702852],
 [6,
  16.0,
  0.048807837069034576,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014816153794527,
  -0.0005609015352092683],
 [6,
  18.0,
  0.045965634286403656,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246647681109607,
  0.0013500606874004006],
 [6,
  5.0,
  0.04222835972905159,
  0.43169596791267395,
  0.852234423160553,
  0.001544719678349793,
  -2.092823342536576e-05],
 [6,
  17.0,
  0.04152437299489975,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269533753395,
  0.0023152935318648815],
 [6,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.0015880210557952523,
  -0.0007841713959351182],
 [6,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.001932673272676766,
  0.006220615468919277,
  0.00047305814223363996],
 [6,
  11.0,
  0.035480305552482605,
  0.5692073702812195,
  0.28337833285331726,
  0.00324416090734303,
  0.0029634025413542986],
 [6,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.00097929616458714,
  -0.002543338341638446],
 [6,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766041707247496,
  -0.0033999979496002197],
 [6,
  1.0,
  0.03337988257408142,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973263652995229,
  -0.0029923722613602877],
 [6,
  1.0,
  0.03324148803949356,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.00595964165404439],
 [6,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895783565938473,
  0.0051577650010585785],
 [6,
  5.0,
  0.03218614310026169,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.004679890815168619],
 [6,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847661823034,
  -0.007043744437396526],
 [6,
  17.0,
  0.02896946296095848,
  0.5695548057556152,
  0.7205935716629028,
  -0.005785795394331217,
  -0.0018508632201701403],
 [6,
  19.0,
  0.02833571471273899,
  0.42402884364128113,
  0.0008106034365482628,
  -0.005690244026482105,
  -0.005403212737292051],
 [6,
  7.0,
  0.027755148708820343,
  0.14687421917915344,
  0.7170413136482239,
  -0.0028729632031172514,
  0.006139386910945177],
 [6,
  11.0,
  0.0273995790630579,
  -0.003346693702042103,
  0.43197140097618103,
  0.0022143693640828133,
  0.005311157088726759],
 [6,
  17.0,
  0.027385596185922623,
  0.002377033932134509,
  -0.007107322104275227,
  -0.004745279438793659,
  0.005192494951188564],
 [6,
  10.0,
  0.02640070579946041,
  0.7067244052886963,
  0.855017364025116,
  -0.001242348924279213,
  0.0039032401982694864],
 [6,
  3.0,
  0.02587714046239853,
  0.5747456550598145,
  -0.0007388432277366519,
  0.002270226366817951,
  -0.004265402443706989],
 [6,
  10.0,
  0.02549077570438385,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.0031593304593116045],
 [6,
  1.0,
  0.021357998251914978,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027908533812],
 [6,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.00526269618421793,
  0.0020898065995424986,
  -0.0055968184024095535],
 [6,
  15.0,
  0.018854619935154915,
  -0.0022594714537262917,
  0.1384880095720291,
  0.0027854801155626774,
  0.005815902724862099],
 [6,
  12.0,
  0.018164733424782753,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829456150531769,
  0.002220866270363331],
 [6,
  10.0,
  0.017963580787181854,
  0.13925801217556,
  0.5659564137458801,
  0.0021879379637539387,
  0.005034215282648802],
 [6,
  19.0,
  0.01641383208334446,
  0.42223626375198364,
  0.4327896535396576,
  -0.00016226971638388932,
  -0.005205052904784679],
 [6,
  3.0,
  0.013968080282211304,
  0.5662983655929565,
  0.8560060262680054,
  0.0054604667238891125,
  0.003514510579407215],
 [6,
  19.0,
  0.010167023167014122,
  0.5683696269989014,
  0.5717867016792297,
  -0.001429215306416154,
  -0.004541652277112007],
 [6,
  11.0,
  0.00943775661289692,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314247518777847,
  -0.005225767847150564],
 [6,
  5.0,
  0.008821118623018265,
  0.14858995378017426,
  0.8628853559494019,
  -0.0027583171613514423,
  0.0005774052115157247],
 [6,
  4.0,
  0.00767514668405056,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203430274501443,
  -0.0008360182982869446],
 [6,
  17.0,
  0.007499022409319878,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506204657256603,
  -0.0004903242806904018],
 [6,
  15.0,
  0.007468376774340868,
  0.2914716899394989,
  0.7104690074920654,
  -0.0004536568303592503,
  -0.002246223157271743],
 [6,
  17.0,
  0.006666154600679874,
  0.7089016437530518,
  0.14547641575336456,
  -0.00255389790982008,
  0.002486428013071418],
 [6,
  2.0,
  0.004264900926500559,
  0.5711851119995117,
  0.43296027183532715,
  0.0026889857836067677,
  0.006471899803727865],
 [6,
  5.0,
  0.004250847734510899,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021462613716722],
 [6,
  17.0,
  0.0005488742608577013,
  0.0021971389651298523,
  0.5736400485038757,
  -0.002658810233697295,
  -0.0026629818603396416],
 [7,
  16.0,
  0.048807840794324875,
  0.28639811277389526,
  0.1367788016796112,
  0.00024014808877836913,
  -0.0005609017098322511],
 [7,
  18.0,
  0.04596562683582306,
  0.14614132046699524,
  0.14432477951049805,
  -0.0006246645352803171,
  0.0013500613858923316],
 [7,
  5.0,
  0.04222835600376129,
  0.43169596791267395,
  0.852234423160553,
  0.0015447194455191493,
  -2.0928748199366964e-05],
 [7,
  17.0,
  0.04152437299489975,
  0.2838396430015564,
  0.5691403150558472,
  -0.003964269533753395,
  0.002315293299034238],
 [7,
  19.0,
  0.03887373208999634,
  0.853602945804596,
  0.2924693822860718,
  0.001588021288625896,
  -0.0007841718033887446],
 [7,
  10.0,
  0.03657899051904678,
  0.28723227977752686,
  0.0019326735055074096,
  0.0062206159345805645,
  0.00047305854968726635],
 [7,
  11.0,
  0.035480301827192307,
  0.5692073702812195,
  0.28337833285331726,
  0.0032441611401736736,
  0.002963402308523655],
 [7,
  0.0,
  0.034344859421253204,
  0.715355634689331,
  0.5746159553527832,
  -0.0009792960481718183,
  -0.002543338807299733],
 [7,
  2.0,
  0.034323837608098984,
  0.2915676236152649,
  0.27988576889038086,
  0.0020766041707247496,
  -0.0033999981824308634],
 [7,
  1.0,
  0.03337988257408142,
  0.8600233197212219,
  0.854455292224884,
  -0.0015973268309608102,
  -0.002992372028529644],
 [7,
  1.0,
  0.03324149176478386,
  0.5760607123374939,
  0.13815787434577942,
  -0.0064412811771035194,
  -0.005959640722721815],
 [7,
  0.0,
  0.03252032771706581,
  0.720090925693512,
  0.2873821258544922,
  0.0030895783565938473,
  0.0051577650010585785],
 [7,
  5.0,
  0.03218614682555199,
  0.29011401534080505,
  0.43338435888290405,
  0.0023512018378823996,
  0.004679890815168619],
 [7,
  0.0,
  0.030840162187814713,
  0.7094765901565552,
  0.4298780560493469,
  -0.004852847661823034,
  -0.007043743971735239],
 [7,
  17.0,
  0.02896946482360363,
  0.5695548057556152,
  0.7205935716629028,
  -0.0057857949286699295,
  -0.0018508631037548184],
 [7,
  19.0,
  0.02833571657538414,
  0.42402884364128113,
  0.0008106033783406019,
  -0.005690244026482105,
  -0.005403212737292051],
 [7,
  7.0,
  0.027755150571465492,
  0.14687421917915344,
  0.7170413136482239,
  -0.002872963435947895,
  0.006139386910945177],
 [7,
  11.0,
  0.0273995790630579,
  -0.0033466939348727465,
  0.43197140097618103,
  0.0022143691312521696,
  0.005311156623065472],
 [7,
  17.0,
  0.027385598048567772,
  0.002377033932134509,
  -0.007107321638613939,
  -0.0047452799044549465,
  0.005192495416849852],
 [7,
  10.0,
  0.026400703936815262,
  0.7067244052886963,
  0.855017364025116,
  -0.0012423486914485693,
  0.0039032401982694864],
 [7,
  3.0,
  0.02587713859975338,
  0.5747456550598145,
  -0.0007388429949060082,
  0.002270226599648595,
  -0.004265402909368277],
 [7,
  10.0,
  0.02549077570438385,
  0.2899598479270935,
  0.8518151640892029,
  0.00406848918646574,
  0.0031593304593116045],
 [7,
  1.0,
  0.021357998251914978,
  0.13988235592842102,
  0.4246824383735657,
  -0.005209512542933226,
  0.004185027908533812],
 [7,
  4.0,
  0.02040451392531395,
  0.14101380109786987,
  -0.005262696649879217,
  0.0020898065995424986,
  -0.0055968184024095535],
 [7,
  15.0,
  0.018854618072509766,
  -0.0022594714537262917,
  0.1384880095720291,
  0.0027854805812239647,
  0.005815903190523386],
 [7,
  12.0,
  0.018164731562137604,
  0.7163902521133423,
  0.7119909524917603,
  -0.0010829456150531769,
  0.002220866270363331],
 [7,
  10.0,
  0.017963577061891556,
  0.13925801217556,
  0.5659564137458801,
  0.0021879379637539387,
  0.005034215282648802],
 [7,
  19.0,
  0.01641383022069931,
  0.42223626375198364,
  0.4327896535396576,
  -0.0001622694981051609,
  -0.005205052439123392],
 [7,
  3.0,
  0.013968080282211304,
  0.5662983655929565,
  0.8560060262680054,
  0.005460467655211687,
  0.003514510579407215],
 [7,
  19.0,
  0.010167023167014122,
  0.5683696269989014,
  0.5717867016792297,
  -0.001429215190000832,
  -0.004541652277112007],
 [7,
  11.0,
  0.00943775661289692,
  0.8632266521453857,
  0.42669495940208435,
  -0.004314247518777847,
  -0.005225767847150564],
 [7,
  5.0,
  0.008821118623018265,
  0.14858995378017426,
  0.8628853559494019,
  -0.0027583171613514423,
  0.0005774050951004028],
 [7,
  4.0,
  0.007675145752727985,
  0.8546355366706848,
  0.7188422083854675,
  -0.0019203427946195006,
  -0.0008360186475329101],
 [7,
  17.0,
  0.007499019615352154,
  0.42597904801368713,
  0.7159280180931091,
  -0.0012506203493103385,
  -0.0004903243388980627],
 [7,
  15.0,
  0.007468379568308592,
  0.2914716899394989,
  0.7104690074920654,
  -0.0004536565684247762,
  -0.002246222924441099],
 [7,
  17.0,
  0.006666154600679874,
  0.7089016437530518,
  0.14547641575336456,
  -0.002553897676989436,
  0.0024864282459020615],
 [7,
  2.0,
  0.004264899529516697,
  0.5711851119995117,
  0.43296027183532715,
  0.0026889850851148367,
  0.006471899803727865],
 [7,
  5.0,
  0.0042508440092206,
  0.4341600239276886,
  0.5686967372894287,
  -0.0048612928949296474,
  -0.0006021459703333676],
 [7,
  17.0,
  0.0005488756578415632,
  0.002197139197960496,
  0.5736400485038757,
  -0.002658810233697295,
  -0.002662982326000929]]</code></pre>
</div>
</div>
<div id="ee1cd649" class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>target_boxes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[[0,
  6.0,
  1.0,
  0.5360000133514404,
  0.5619999766349792,
  0.9013333916664124,
  0.5360000133514404],
 [1,
  7.0,
  1.0,
  0.48842108249664307,
  0.512499988079071,
  0.8294737339019775,
  0.9458333849906921],
 [2,
  7.0,
  1.0,
  0.27500003576278687,
  0.4933333694934845,
  0.5099999904632568,
  0.3893333673477173],
 [2,
  7.0,
  1.0,
  0.7120000720024109,
  0.4560000002384186,
  0.5040000677108765,
  0.4480000436306],
 [3,
  1.0,
  1.0,
  0.5913174152374268,
  0.5429999828338623,
  0.6377246379852295,
  0.8019999861717224],
 [4,
  14.0,
  1.0,
  0.514970064163208,
  0.4610000252723694,
  0.5928143858909607,
  0.9220000505447388],
 [4,
  14.0,
  1.0,
  0.8742515444755554,
  0.5040000677108765,
  0.24550898373126984,
  0.9360000491142273],
 [4,
  1.0,
  1.0,
  0.48353296518325806,
  0.7000000476837158,
  0.5538922548294067,
  0.5960000157356262],
 [5,
  6.0,
  1.0,
  0.6390000581741333,
  0.5675675868988037,
  0.718000054359436,
  0.8408408761024475],
 [6,
  14.0,
  1.0,
  0.37700000405311584,
  0.5640000104904175,
  0.15800002217292786,
  0.3813333213329315],
 [6,
  12.0,
  1.0,
  0.3370000422000885,
  0.6666667461395264,
  0.4020000398159027,
  0.421333372592926],
 [6,
  14.0,
  1.0,
  0.5529999732971191,
  0.7000000476837158,
  0.07800000160932541,
  0.34933337569236755],
 [6,
  14.0,
  1.0,
  0.6100000143051147,
  0.7066667079925537,
  0.08400000631809235,
  0.34666669368743896],
 [7,
  14.0,
  1.0,
  0.3184524178504944,
  0.445000022649765,
  0.369047611951828,
  0.5659999847412109],
 [7,
  14.0,
  1.0,
  0.80952388048172,
  0.515999972820282,
  0.3750000298023224,
  0.8920000195503235],
 [7,
  11.0,
  1.0,
  0.269345223903656,
  0.6210000514984131,
  0.538690447807312,
  0.3059999942779541]]</code></pre>
</div>
</div>
<p>Inside of <a href="https://galopyz.github.io/pilus_project/yolov1.html#mean_average_precision"><code>mean_average_precision</code></a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/galopyz\.github\.io\/pilus_project");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/galopyz/pilus_project/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>